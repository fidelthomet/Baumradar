<!DOCTYPE html >
	<html >
	<head >
	<title > Drag - and - Drop image vector example </title> <script src = "libs/jquery-2.1.4.min.js " > </script> <link rel = "
stylesheet "
href = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" >
	<script src = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" > </script> <link rel = "stylesheet"
href = "http://openlayers.org/en/v3.9.0/css/ol.css"
type = "text/css" >
	<script src = "http://openlayers.org/en/v3.9.0/build/ol.js" > </script> <script src = "scripts/requests.js " > </script>

</head> <body > <div class = "container-fluid" >

	<div class = "row-fluid" >
	<div class = "span12" >
	<div id = "map"
class = "map" > </div> <div class = "span4 offset4 pull-right" > <div id = "info"
class = "alert alert-success" >
	&nbsp; </div> </div > </div> </div >

</div> <script >

var state = {
	watchposition: true,
	geolocation: false,
	compass: false,
	user: {
		location: [8.545953265970327, 47.364551977441565],
		heading: 0
	},
	lastRequest: [8.545953265970327, 47.364551977441565],
	ready: {
		center: false
	},
	params: {
		r: 250
	},
	trees: {},
	treeList: [],
	wiki: {},
	proxy: "http://crossorigin.me/"
}

new Promise(getDistricts).then(function(districts) {
	// console.log(districts)


	console.log((new ol.format.GeoJSON()).readFeatures(districts))

	var vectorSource = new ol.source.Vector({
		features: (new ol.format.GeoJSON()).readFeatures(districts, {
			
			featureProjection: "EPSG:3857"
		}),
		projection: "EPSG:3857"
	});
	map.addLayer(new ol.layer.Image({
		source: new ol.source.ImageVector({
			source: vectorSource,
			style: styleFunction
		})
	}));
	map.getView().fit(
		vectorSource.getExtent(), /** @type {ol.Size} */ (map.getSize()));

})

var defaultStyle = {
	'Point': [new ol.style.Style({
		image: new ol.style.Circle({
			fill: new ol.style.Fill({
				color: 'rgba(255,255,0,0.5)'
			}),
			radius: 5,
			stroke: new ol.style.Stroke({
				color: '#ff0',
				width: 1
			})
		})
	})],
	'LineString': [new ol.style.Style({
		stroke: new ol.style.Stroke({
			color: '#f00',
			width: 3
		})
	})],
	'Polygon': [new ol.style.Style({
		fill: new ol.style.Fill({
			color: 'rgba(0,255,255,0.5)'
		}),
		stroke: new ol.style.Stroke({
			color: '#0ff',
			width: 1
		})
	})],
	'MultiPoint': [new ol.style.Style({
		image: new ol.style.Circle({
			fill: new ol.style.Fill({
				color: 'rgba(255,0,255,0.5)'
			}),
			radius: 5,
			stroke: new ol.style.Stroke({
				color: '#f0f',
				width: 1
			})
		})
	})],
	'MultiLineString': [new ol.style.Style({
		stroke: new ol.style.Stroke({
			color: '#0f0',
			width: 3
		})
	})],
	'MultiPolygon': [new ol.style.Style({
		fill: new ol.style.Fill({
			color: 'rgba(0,0,255,0.5)'
		}),
		stroke: new ol.style.Stroke({
			color: '#00f',
			width: 1
		})
	})]
};

var styleFunction = function(feature, resolution) {
	var featureStyleFunction = feature.getStyleFunction();
	if (featureStyleFunction) {
		return featureStyleFunction.call(feature, resolution);
	} else {
		return defaultStyle[feature.getGeometry().getType()];
	}
};

var dragAndDropInteraction = new ol.interaction.DragAndDrop({
	formatConstructors: [
		ol.format.GPX,
		ol.format.GeoJSON,
		ol.format.IGC,
		ol.format.KML,
		ol.format.TopoJSON
	]
});

var map = new ol.Map({
	interactions: ol.interaction.defaults().extend([dragAndDropInteraction]),
	layers: [
		new ol.layer.Tile({
			source: new ol.source.BingMaps({
				imagerySet: 'Aerial',
				key: 'Ak-dzM4wZjSqTlzveKz5u0d4IQ4bRzVI309GxmkgSVr1ewS6iPSrOvOKhA-CJlm3'
			})
		})
	],
	target: 'map',
	view: new ol.View({
		center: [0, 0],
		zoom: 2
	})
});

dragAndDropInteraction.on('addfeatures', function(event) {

	console.log(event)

	var vectorSource = new ol.source.Vector({
		features: event.features
	});
	map.addLayer(new ol.layer.Image({
		source: new ol.source.ImageVector({
			source: vectorSource,
			style: styleFunction
		})
	}));
	map.getView().fit(
		vectorSource.getExtent(), /** @type {ol.Size} */ (map.getSize()));
});

var displayFeatureInfo = function(pixel) {
	var features = [];
	map.forEachFeatureAtPixel(pixel, function(feature, layer) {
		features.push(feature);
	});
	if (features.length > 0) {
		var info = [];
		var i, ii;
		for (i = 0, ii = features.length; i <ii; ++i) {
			info.push(features[i].get('name'));
		}
		document.getElementById('info').innerHTML = info.join(', ') || '&nbsp';
	} else {
		document.getElementById('info').innerHTML = '&nbsp;';
	}
};

map.on('pointermove', function(evt) {
	if (evt.dragging) {
		return;
	}
	var pixel = map.getEventPixel(evt.originalEvent);
	displayFeatureInfo(pixel);
});

map.on('click', function(evt) {
	displayFeatureInfo(evt.pixel);
});

</script> </body > </html>